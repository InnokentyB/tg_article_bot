#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ Railway –≤–µ—Ä—Å–∏–π –±–æ—Ç–∞
"""
import asyncio
from dotenv import load_dotenv
import os
import requests

def test_local_bot():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç"""
    print("üè† –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –õ–û–ö–ê–õ–¨–ù–û–ì–û –±–æ—Ç–∞...")
    
    load_dotenv()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    token = os.getenv('ARTICLE_BOT_TOKEN')
    database_url = os.getenv('DATABASE_URL')
    
    print(f"   üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:")
    print(f"      –¢–æ–∫–µ–Ω: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' if token else '‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'}")
    print(f"      –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: {'‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞' if database_url else '‚ùå –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'}")
    
    if database_url:
        if 'localhost:5433' in database_url:
            print(f"      üóÑÔ∏è –õ–æ–∫–∞–ª—å–Ω–∞—è PostgreSQL (–ø–æ—Ä—Ç 5433)")
        else:
            print(f"      üåê –í–Ω–µ—à–Ω—è—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å
    import subprocess
    try:
        result = subprocess.run(['ps', 'aux'], capture_output=True, text=True)
        if 'telegram_bot.py' in result.stdout:
            print("   ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ –∑–∞–ø—É—â–µ–Ω")
            return True
        else:
            print("   ‚ùå –ü—Ä–æ—Ü–µ—Å—Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω")
            return False
    except Exception as e:
        print(f"   ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞: {e}")
        return False

def test_railway_bot():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º Railway –±–æ—Ç"""
    print("\nüöÇ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ RAILWAY –±–æ—Ç–∞...")
    
    railway_url = "https://tg-article-bot-api-production-12d6.up.railway.app"
    
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Railway
        response = requests.get(f"{railway_url}/health", timeout=10)
        if response.status_code == 200:
            print("   ‚úÖ Railway API –¥–æ—Å—Ç—É–ø–µ–Ω")
            return True
        else:
            print(f"   ‚ùå Railway API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (—Å—Ç–∞—Ç—É—Å: {response.status_code})")
            return False
    except Exception as e:
        print(f"   ‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Railway: {e}")
        return False

def test_web_admin():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–µ–±-–∞–¥–º–∏–Ω–∫—É"""
    print("\nüåê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ–±-–∞–¥–º–∏–Ω–∫–∏...")
    
    # –õ–æ–∫–∞–ª—å–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞
    try:
        response = requests.get("http://localhost:8000", timeout=5)
        if response.status_code == 200:
            print("   ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ–±-–∞–¥–º–∏–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ (http://localhost:8000)")
        else:
            print(f"   ‚ùå –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ–±-–∞–¥–º–∏–Ω–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (—Å—Ç–∞—Ç—É—Å: {response.status_code})")
    except Exception as e:
        print(f"   ‚ùå –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ–±-–∞–¥–º–∏–Ω–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: {e}")
    
    # Railway –∞–¥–º–∏–Ω–∫–∞
    railway_url = "https://tg-article-bot-api-production-12d6.up.railway.app"
    try:
        response = requests.get(railway_url, timeout=10)
        if response.status_code == 200:
            print("   ‚úÖ Railway –≤–µ–±-–∞–¥–º–∏–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞")
        else:
            print(f"   ‚ùå Railway –≤–µ–±-–∞–¥–º–∏–Ω–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ (—Å—Ç–∞—Ç—É—Å: {response.status_code})")
    except Exception as e:
        print(f"   ‚ùå Railway –≤–µ–±-–∞–¥–º–∏–Ω–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: {e}")

def compare_versions():
    """–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏–∏"""
    print("\nüìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π:")
    
    print("\nüè† –õ–û–ö–ê–õ–¨–ù–ê–Ø –≤–µ—Ä—Å–∏—è:")
    print("   ‚úÖ –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –±–æ—Ç —Å —Ä–µ–∞–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–µ–π")
    print("   ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö")
    print("   ‚úÖ AI –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å OpenAI –∫–ª—é—á)")
    print("   ‚úÖ BART –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è")
    print("   ‚úÖ –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è")
    print("   ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–π")
    print("   ‚úÖ –ê–Ω–∞–ª–∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤")
    print("   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤")
    print("   ‚ùå –¢—Ä–µ–±—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä")
    print("   ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ")
    
    print("\nüöÇ RAILWAY –≤–µ—Ä—Å–∏—è:")
    print("   ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ")
    print("   ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ")
    print("   ‚úÖ HTTPS")
    print("   ‚úÖ –í–µ–±-–∞–¥–º–∏–Ω–∫–∞")
    print("   ‚ùå –ü—Ä–æ—Å—Ç–æ–π –¥–µ–º–æ-–±–æ—Ç")
    print("   ‚ùå Mock –¥–∞–Ω–Ω—ã–µ")
    print("   ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è")

def show_recommendations():
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"""
    print("\nüí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:")
    
    print("\nüéØ –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:")
    print("   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –õ–û–ö–ê–õ–¨–ù–£–Æ –≤–µ—Ä—Å–∏—é")
    print("   ‚Ä¢ –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª")
    print("   ‚Ä¢ –†–µ–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö")
    print("   ‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è –æ—Ç–ª–∞–¥–∫–∞")
    
    print("\nüåê –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:")
    print("   ‚Ä¢ –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é –Ω–∞ Railway")
    print("   ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ PostgreSQL –Ω–∞ Railway")
    print("   ‚Ä¢ –î–æ–±–∞–≤—å—Ç–µ Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è")
    print("   ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥")
    
    print("\nüîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è Railway:")
    print("   1. –°–æ–∑–¥–∞—Ç—å PostgreSQL —Å–µ—Ä–≤–∏—Å –Ω–∞ Railway")
    print("   2. –û–±–Ω–æ–≤–∏—Ç—å DATABASE_URL")
    print("   3. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å telegram_bot.py")
    print("   4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üîç –ê–Ω–∞–ª–∏–∑ –≤–µ—Ä—Å–∏–π –±–æ—Ç–∞\n")
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç
    local_ok = test_local_bot()
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º Railway –±–æ—Ç
    railway_ok = test_railway_bot()
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–µ–±-–∞–¥–º–∏–Ω–∫—É
    test_web_admin()
    
    # –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≤–µ—Ä—Å–∏–∏
    compare_versions()
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    show_recommendations()
    
    print(f"\nüìã –ò–¢–û–ì:")
    if local_ok:
        print("   ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç")
    else:
        print("   ‚ùå –õ–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç")
    
    if railway_ok:
        print("   ‚úÖ Railway –¥–æ—Å—Ç—É–ø–µ–Ω")
    else:
        print("   ‚ùå Railway –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
    
    print("\nüéØ –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï:")
    print("   ‚Ä¢ –õ–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç: –ó–ê–ü–£–©–ï–ù —Å –ø–æ–ª–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º")
    print("   ‚Ä¢ Railway: –î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤–µ–±-–∞–¥–º–∏–Ω–∫–∏")
    print("   ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π –±–æ—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è")

if __name__ == "__main__":
    main()
