<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ–º–æ API —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—å—è–º–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .article {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .article-title {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        .article-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        .categories {
            display: flex;
            gap: 5px;
            margin: 5px 0;
        }
        .category-tag {
            background-color: #e9ecef;
            padding: 2px 8px;
            border-radius: 15px;
            font-size: 0.8em;
        }
        #loading {
            display: none;
            color: #666;
            font-style: italic;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ –î–µ–º–æ API —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—å—è–º–∏</h1>
        <p>–≠—Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—å—è–º–∏ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞.</p>
        
        <div>
            <button onclick="loadArticles()">üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç—å–∏</button>
            <button onclick="loadStatistics()">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button onclick="testHealth()">üíö –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API</button>
        </div>
        
        <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <div class="container">
        <h2>–°–æ—Å—Ç–æ—è–Ω–∏–µ API</h2>
        <div id="health-status">–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å API" –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏</div>
    </div>

    <div class="container">
        <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div id="statistics">–ù–∞–∂–º–∏—Ç–µ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>
    </div>

    <div class="container">
        <h2>–°—Ç–∞—Ç—å–∏</h2>
        <div id="articles">–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç—å–∏" –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
    </div>

    <div class="container">
        <h2>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h2>
        <ol>
            <li><strong>–°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞:</strong> –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram –∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞</li>
            <li><strong>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω:</strong> –¢–æ–∫–µ–Ω —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–µ–∫—Ä–µ—Ç—ã Replit</li>
            <li><strong>–ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞:</strong> –ù–∞–π–¥–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram –ø–æ –∏–º–µ–Ω–∏</li>
            <li><strong>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Ç–∞—Ç—å—é:</strong> –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ –∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∞—Ç—å—é</li>
            <li><strong>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –°—Ç–∞—Ç—å—è –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
        </ol>
        
        <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ API endpoints:</h3>
        <ul>
            <li><code>GET /api/health</code> - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</li>
            <li><code>GET /api/articles</code> - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π</li>
            <li><code>GET /api/articles/{id}</code> - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç–∞—Ç—å–∏</li>
            <li><code>GET /api/articles/fingerprint/{fingerprint}</code> - –ø–æ–∏—Å–∫ –ø–æ –æ—Ç–ø–µ—á–∞—Ç–∫—É</li>
            <li><code>PUT /api/articles/{id}/counters</code> - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤</li>
            <li><code>GET /api/statistics</code> - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</li>
        </ul>
    </div>

    <script>
        const API_BASE = '/api';

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        async function testHealth() {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                document.getElementById('health-status').innerHTML = `
                    <div style="color: green;">‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                    <div>–°–µ—Ä–≤–∏—Å: ${data.service}</div>
                    <div>–°—Ç–∞—Ç—É—Å: ${data.status}</div>
                `;
            } catch (error) {
                document.getElementById('health-status').innerHTML = `
                    <div style="color: red;">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API</div>
                    <div>${error.message}</div>
                `;
            }
            showLoading(false);
        }

        async function loadArticles() {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/articles?limit=20`);
                const articles = await response.json();
                
                if (articles.length === 0) {
                    document.getElementById('articles').innerHTML = `
                        <div style="text-align: center; color: #666; padding: 40px;">
                            <h3>üìù –°—Ç–∞—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                            <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Ç–∞—Ç—å—é –±–æ—Ç—É –≤ Telegram, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ—ë –∑–¥–µ—Å—å</p>
                            <p>–ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–∫ —Ç–µ–∫—Å—Ç, —Ç–∞–∫ –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç–∞—Ç—å–∏</p>
                        </div>
                    `;
                } else {
                    const articlesHtml = articles.map(article => `
                        <div class="article">
                            <div class="article-title">${article.title || '–ë–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞'}</div>
                            <div class="article-meta">
                                üìÖ ${new Date(article.created_at).toLocaleString('ru')} | 
                                üåê ${article.language || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} |
                                üë§ ID: ${article.telegram_user_id || '–∞–Ω–æ–Ω–∏–º'}
                            </div>
                            <div class="categories">
                                ${(article.categories_auto || []).map(cat => `<span class="category-tag">${cat}</span>`).join('')}
                            </div>
                            <div style="margin-top: 10px;">
                                ${article.summary || article.text?.substring(0, 200) + '...'}
                            </div>
                            <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                üí¨ ${article.comments_count} | üëç ${article.likes_count} | üëÅÔ∏è ${article.views_count}
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('articles').innerHTML = articlesHtml;
                }
            } catch (error) {
                document.getElementById('articles').innerHTML = `
                    <div style="color: red;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–µ–π: ${error.message}</div>
                `;
            }
            showLoading(false);
        }

        async function loadStatistics() {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/statistics`);
                const stats = await response.json();
                
                let statsHtml = `<div class="stats">`;
                statsHtml += `<div class="stat-card">
                    <div class="stat-number">${stats.total_articles}</div>
                    <div>–í—Å–µ–≥–æ —Å—Ç–∞—Ç–µ–π</div>
                </div>`;
                
                const categoryCount = Object.keys(stats.categories || {}).length;
                statsHtml += `<div class="stat-card">
                    <div class="stat-number">${categoryCount}</div>
                    <div>–ö–∞—Ç–µ–≥–æ—Ä–∏–π</div>
                </div>`;
                
                const languageCount = Object.keys(stats.languages || {}).length;
                statsHtml += `<div class="stat-card">
                    <div class="stat-number">${languageCount}</div>
                    <div>–Ø–∑—ã–∫–æ–≤</div>
                </div>`;
                
                const sourceCount = Object.keys(stats.top_sources || {}).length;
                statsHtml += `<div class="stat-card">
                    <div class="stat-number">${sourceCount}</div>
                    <div>–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤</div>
                </div>`;
                
                statsHtml += `</div>`;
                
                if (stats.categories && Object.keys(stats.categories).length > 0) {
                    statsHtml += `<h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</h3>`;
                    Object.entries(stats.categories).slice(0, 10).forEach(([cat, count]) => {
                        statsHtml += `<span class="category-tag">${cat}: ${count}</span> `;
                    });
                }
                
                document.getElementById('statistics').innerHTML = statsHtml;
            } catch (error) {
                document.getElementById('statistics').innerHTML = `
                    <div style="color: red;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}</div>
                `;
            }
            showLoading(false);
        }

        // Auto-load health check on page load
        document.addEventListener('DOMContentLoaded', function() {
            testHealth();
        });
    </script>
</body>
</html>